!function(){"use strict";var Timesheet=function(container,min,max,data){this.data=[],this.year={min:min,max:max},this.useMonths=this.year.max-this.year.min<2,this.parse(data||[]),"undefined"!=typeof document&&(this.container="string"==typeof container?document.querySelector("#"+container):container,this.drawSections(),this.insertData())};Timesheet.prototype.insertData=function(){var html=[],scaleEl=this.container.querySelector(".scale"),sectionEl=this.container.querySelector(".scale section"),sectionWidth=sectionEl.offsetWidth,widthMonth=this.useMonths?12*sectionWidth:sectionWidth,numSectionsInChart=document.querySelectorAll(".scale section").length;this.scaleWidth=(numSectionsInChart*(sectionWidth+2)).toString()+"px",scaleEl.style.width=this.scaleWidth;for(var n=0,m=this.data.length;n<m;n++){var cur=this.data[n],bubble=this.createBubble(widthMonth,this.useMonths,this.year.min,cur.start,cur.end),line=['<span title="'+Bubble.getStringFromHtml(cur.label)+'" style="margin-left: '+bubble.getStartOffset(this.firstMonth)+"px; width: "+bubble.getWidth()+'px;" class="bubble bubble-'+(cur.type||"default")+'" data-duration="'+(cur.end?Math.round((cur.end-cur.start)/1e3/60/60/24/39):"")+'">','<div class="label">'+cur.label+"</div>","</span>"].join("");html.push('<li><div class="bubble-wrapper">'+line+"</div></li>")}this.container.innerHTML+='<ul class="data">'+html.join("")+"</ul>",this.container.querySelector("ul.data").style.width=this.scaleWidth},Timesheet.prototype.drawSections=function(){var html=[];if(this.useMonths){for(var numMonths=0,c=this.year.min;c<=this.year.max;c++)for(var months=this.getFirstAndLastMonth(c),m=months.first;m<=months.last;m++){numMonths++;var month=m.toString();html.push('<section class="month">'+month+"/"+c+"</section>")}numMonths<12&&(html=html.map(function(sectionHtml){return sectionHtml.replace('class="month"','class="month" style="width: '+(18-numMonths).toString()+'vw"')}))}else for(var y=this.year.min;y<=this.year.max;y++)html.push("<section>"+y+"</section>");this.container.className="timesheet color-scheme-default",this.container.innerHTML='<div class="scale">'+html.join("")+"</div>"},Timesheet.prototype.getFirstAndLastMonth=function(currentYear){function getFirstOrLatestMonthInChart(self,which){return function(month,current){var startOrEnd="first"===which?"start":"end",minOrMax="first"===which?"min":"max",thisYear=current[startOrEnd].getFullYear(),thisMonth=thisYear===self.year[minOrMax]?current[startOrEnd].getMonth():month;return Math[minOrMax](month,thisMonth)}}var firstMonth=1,lastMonth=12;return currentYear===this.year.min&&(firstMonth=1+this.data.reduce(getFirstOrLatestMonthInChart(this,"first"),11),this.firstMonth=firstMonth),currentYear===this.year.max&&(lastMonth=1+this.data.reduce(getFirstOrLatestMonthInChart(this,"last"),0),this.lastMonth=lastMonth),{first:firstMonth,last:lastMonth}},Timesheet.prototype.parseDate=function(date){var dateParts=date.split("/");return 1===dateParts.length?(date=new Date(parseInt(date,10),0,1),date.hasMonth=!1):2===dateParts.length?(date=new Date(parseInt(dateParts[1],10),parseInt(dateParts[0],10)-1,1),date.hasMonth=!0):(date=new Date(parseInt(dateParts[2],10),parseInt(dateParts[0],10)-1,parseInt(dateParts[1],10)),date.hasMonth=!0),date},Timesheet.prototype.parse=function(data){for(var n=0,m=data.length;n<m;n++){var beg=this.parseDate(data[n][0]),end=4===data[n].length?this.parseDate(data[n][1]):null,lbl=4===data[n].length?data[n][2]:data[n][1],cat=4===data[n].length?data[n][3]:3===data[n].length?data[n][2]:"default";beg.getFullYear()<this.year.min&&(this.year.min=beg.getFullYear()),end&&end.getFullYear()>this.year.max?this.year.max=end.getFullYear():beg.getFullYear()>this.year.max&&(this.year.max=beg.getFullYear()),this.data.push({start:beg,end:end,label:lbl,type:cat})}},Timesheet.prototype.createBubble=function(wMonth,useMonths,min,start,end){return new Bubble(wMonth,useMonths,min,start,end)};var Bubble=function(wMonth,useMonths,min,start,end){this.min=min,this.start=start,this.end=end,this.widthMonth=wMonth,this.useMonths=useMonths};Bubble.prototype.formatMonth=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getStartOffset=function(firstMonthInChart){var monthWidthPixels=this.widthMonth/12,checkAgainstStartMonth=this.useMonths?this.start.getMonth()-(firstMonthInChart-1):this.start.getMonth(),monthOffset=monthWidthPixels*(12*(this.start.getFullYear()-this.min)+checkAgainstStartMonth);return this.useMonths&&(monthOffset+=monthWidthPixels*(this.start.getDate()/30)),monthOffset},Bubble.prototype.getFullYears=function(){return(this.end&&this.end.getFullYear()||this.start.getFullYear())-this.start.getFullYear()},Bubble.prototype.getMonths=function(){var fullYears=this.getFullYears(),months=0;return this.end?this.end.hasMonth?(months+=this.end.getMonth()+1,months+=12-(this.start.hasMonth?this.start.getMonth():0),months+=12*(fullYears-1)):(months+=12-(this.start.hasMonth?this.start.getMonth():0),months+=12*(fullYears-1>0?fullYears-1:0)):months+=this.start.hasMonth?1:12,months},Bubble.prototype.getWidth=function(){var fullMonthsWidth=this.widthMonth/12*this.getMonths();if(this.useMonths){var monthWidthPixels=this.widthMonth/12;fullMonthsWidth=fullMonthsWidth-monthWidthPixels*(this.start.getDate()/30)-(monthWidthPixels-monthWidthPixels*(this.end.getDate()/30))}return fullMonthsWidth},Bubble.prototype.getDateLabel=function(){return[(this.start.hasMonth?this.formatMonth(this.start.getMonth()+1)+"/":"")+this.start.getFullYear(),this.end?"-"+(this.end.hasMonth?this.formatMonth(this.end.getMonth()+1)+"/":"")+this.end.getFullYear():""].join("")},Bubble.getStringFromHtml=function(htmlString){var html=htmlString||"",div=document.createElement("div");return div.innerHTML=html,(div.textContent||div.innerText||"").replace(/(\r\n|\n)/g," ").replace(/\s{2,}/g," ")},window.Timesheet=Timesheet}();